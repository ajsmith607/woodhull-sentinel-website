# Newspaper Archive UI Implementation Plan

**Purpose:** This document provides detailed specifications for implementing the web interface for a newspaper archive search project. Read this in conjunction with `claude.md` which contains project overview and data specifications.

---

## Technology Stack

### Static Site Generator
- **Eleventy** (11ty) - Latest stable version
- **Templating:** Nunjucks (11ty default, minimal syntax)

### Frontend Libraries
- **simple.css** - Classless CSS framework (via CDN)
- **FlexSearch** - Client-side full-text search (via CDN or local copy)
- **Panzoom** - Image pan/zoom functionality (via CDN or local copy)
- **jQuery** - Only if needed for specific functionality (avoid if possible)

### Build Output
- Pure static HTML/CSS/JS files
- Must work from `file://` protocol (no absolute paths, no server dependencies)
- All assets referenced with relative paths

---

## Project File Structure

```
newspaper-archive/
├── .eleventy.js                 # Eleventy configuration
├── package.json                 # Dependencies (11ty only)
├── data/                        # Newspaper files (see claude.md)
│   ├── JPEGs/
│   ├── THUMBs/
│   └── TXTs/
├── src/                         # Source files for Eleventy
│   ├── _includes/               # Eleventy templates and partials
│   │   ├── layouts/
│   │   │   └── base.njk        # HTML boilerplate layout
│   │   ├── components/
│   │   │   ├── header.njk      # Site header
│   │   │   ├── footer.njk      # Site footer
│   │   │   └── search-form.njk # Search form component
│   │   └── macros/
│   │       └── issue-card.njk  # Reusable issue/page card
│   ├── assets/
│   │   ├── css/
│   │   │   └── custom.css      # Custom styles (minimal overrides)
│   │   └── js/
│   │       ├── search.js       # FlexSearch integration
│   │       ├── viewer.js       # Panzoom image viewer
│   │       └── navigation.js   # Page/issue navigation logic
│   ├── index.njk                # Home page
│   ├── browse.njk               # Browse by year/issue
│   ├── search.njk               # Search results page
│   ├── about.njk                # About page
│   └── detail.njk               # Detail page template (generated per page)
├── build/                       # Build scripts (separate planning docs)
│   ├── generate-index.js        # Creates search-index.json
│   └── generate-metadata.js     # Creates issues-metadata.json
└── _site/                       # Eleventy output (gitignored)
    ├── index.html
    ├── browse/
    ├── search/
    ├── about/
    ├── pages/                   # Detail pages for each newspaper page
    ├── assets/
    ├── search-index.json        # Generated by build script
    └── issues-metadata.json     # Generated by build script
```

---

## Data Files (Generated by Build Scripts)

These JSON files will be created by separate build scripts and consumed by the UI:

### 1. `search-index.json`
FlexSearch index file containing:
```json
{
  "id": 0,
  "filename": "woodhull-sentinel-19390803-001",
  "newspaper": "Woodhull Sentinel",
  "date": "1939-08-03",
  "dateDisplay": "August 3, 1939",
  "pageNumber": 1,
  "issueId": "woodhull-sentinel-19390803",
  "content": "Full OCR text content here..."
}
```

### 2. `issues-metadata.json`
Complete collection metadata for browse page:
```json
{
  "years": {
    "1939": {
      "totalPages": 245,
      "issues": [
        {
          "id": "woodhull-sentinel-19390803",
          "newspaper": "Woodhull Sentinel",
          "date": "1939-08-03",
          "dateDisplay": "August 3, 1939",
          "pageCount": 6,
          "pages": [
            {
              "pageNumber": 1,
              "filename": "woodhull-sentinel-19390803-001",
              "thumbnail": "../data/THUMBs/woodhull-sentinel-19390803/woodhull-sentinel-19390803-001.jpg",
              "jpg": "../data/JPEGs/woodhull-sentinel-19390803/woodhull-sentinel-19390803-001.jpg"
            }
          ]
        }
      ]
    }
  },
  "allPages": [
    {
      "filename": "woodhull-sentinel-19390803-001",
      "newspaper": "Woodhull Sentinel",
      "date": "1939-08-03",
      "dateDisplay": "August 3, 1939",
      "pageNumber": 1,
      "issueId": "woodhull-sentinel-19390803",
      "thumbnail": "../data/THUMBs/woodhull-sentinel-19390803/woodhull-sentinel-19390803-001.jpg",
      "jpg": "../data/JPEGs/woodhull-sentinel-19390803/woodhull-sentinel-19390803-001.jpg",
      "prevPage": null,
      "nextPage": "woodhull-sentinel-19390803-002",
      "prevIssue": "woodhull-sentinel-19390726",
      "nextIssue": "woodhull-sentinel-19390810"
    }
  ]
}
```

---

## Eleventy Configuration

### `.eleventy.js`

```javascript
module.exports = function(eleventyConfig) {
  // Pass through data directory (images, text files)
  eleventyConfig.addPassthroughCopy("data");
  
  // Pass through assets
  eleventyConfig.addPassthroughCopy("src/assets");
  
  // Pass through generated JSON files
  eleventyConfig.addPassthroughCopy("search-index.json");
  eleventyConfig.addPassthroughCopy("issues-metadata.json");
  
  // Global data: load metadata
  eleventyConfig.addGlobalData("metadata", () => {
    return require("./issues-metadata.json");
  });
  
  return {
    dir: {
      input: "src",
      output: "_site",
      includes: "_includes",
      data: "_data"
    },
    templateFormats: ["njk", "html", "md"],
    htmlTemplateEngine: "njk"
  };
};
```

---

## Page Specifications

### 1. Home Page (`src/index.njk`)

**Layout:** Uses `base.njk`

**Content:**
- Project title and brief description
- Quick statistics: Total issues, total pages, date range
- Featured search form (centered, prominent)
- Quick links to Browse and About pages

**Data needed:** 
- Calculate totals from `issues-metadata.json`

**Template structure:**
```njk
---
layout: layouts/base.njk
title: "Newspaper Archive"
---

<section class="hero">
  <h1>Historical Newspaper Archive</h1>
  <p>Search and browse {{ metadata.totalPages }} pages from {{ metadata.totalIssues }} newspaper issues</p>
  
  {% include "components/search-form.njk" %}
  
  <nav class="quick-links">
    <a href="browse/">Browse by Year</a>
    <a href="about/">About this Collection</a>
  </nav>
</section>

<section class="stats">
  <div>
    <strong>{{ metadata.totalIssues }}</strong>
    <span>Issues</span>
  </div>
  <div>
    <strong>{{ metadata.totalPages }}</strong>
    <span>Pages</span>
  </div>
  <div>
    <strong>{{ metadata.dateRange }}</strong>
    <span>Date Range</span>
  </div>
</section>
```

---

### 2. Browse Page (`src/browse.njk`)

**Layout:** Uses `base.njk`

**Content:**
- Page title: "Browse by Year"
- Search form at top
- Grouped by year (descending order)
- Each year shows:
  - Year as heading
  - Total page count for that year
  - List of issues with:
    - First page thumbnail
    - Newspaper name
    - Date (formatted)
    - Page count
    - Link to first page

**Data source:** `issues-metadata.json`

**Template structure:**
```njk
---
layout: layouts/base.njk
title: "Browse Archive"
---

<h1>Browse by Year</h1>

{% include "components/search-form.njk" %}

{% for year, yearData in metadata.years | reverse %}
<section class="year-group">
  <h2>{{ year }} <span class="page-count">({{ yearData.totalPages }} pages)</span></h2>
  
  <div class="issues-grid">
    {% for issue in yearData.issues %}
    <article class="issue-card">
      <a href="../pages/{{ issue.pages[0].filename }}/">
        <img src="{{ issue.pages[0].thumbnail }}" alt="{{ issue.newspaper }} - {{ issue.dateDisplay }}" loading="lazy">
      </a>
      <h3>{{ issue.newspaper }}</h3>
      <time>{{ issue.dateDisplay }}</time>
      <p>{{ issue.pageCount }} pages</p>
    </article>
    {% endfor %}
  </div>
</section>
{% endfor %}
```

---

### 3. Search Results Page (`src/search.njk`)

**Layout:** Uses `base.njk`

**Content:**
- Search form at top (with current query pre-filled)
- Results count
- Grid of matching pages:
  - Thumbnail image
  - Newspaper name
  - Date
  - Page number
  - Link to detail page

**Behavior:**
- JavaScript reads `?q=` query parameter from URL
- Loads `search-index.json`
- Performs FlexSearch query
- Dynamically renders results

**Template structure:**
```njk
---
layout: layouts/base.njk
title: "Search Results"
---

<h1>Search Results</h1>

{% include "components/search-form.njk" %}

<div id="results-info">
  <p id="results-count"></p>
</div>

<div id="results-grid" class="results-grid">
  <!-- Populated by search.js -->
</div>

<script src="../assets/js/search.js"></script>
```

**JavaScript (`assets/js/search.js`):**
- Load FlexSearch library
- Read query from URL params
- Load `search-index.json`
- Execute search
- Render results dynamically
- Support boolean operators (AND, OR, NOT)

---

### 4. Detail Page (`src/detail.njk`)

**Note:** This is a **template** that Eleventy will use to generate individual HTML pages for each newspaper page in the collection.

**Layout:** Uses `base.njk`

**Eleventy Configuration:**
Use pagination to generate a page for each item in `allPages`:

```njk
---
layout: layouts/base.njk
pagination:
  data: metadata.allPages
  size: 1
  alias: page
permalink: "pages/{{ page.filename }}/"
title: "{{ page.newspaper }} - {{ page.dateDisplay }} - Page {{ page.pageNumber }}"
---
```

**Content:**
- Newspaper name and date in header
- Page number indicator
- Zoomable image viewer (Panzoom)
- Download button (links to full JPG)
- Navigation controls:
  - Previous page / Next page (within same issue)
  - Previous issue / Next issue (links to first page)

**Template structure:**
```njk
<article class="detail-page">
  <header class="page-header">
    <h1>{{ page.newspaper }}</h1>
    <time>{{ page.dateDisplay }}</time>
    <span class="page-number">Page {{ page.pageNumber }}</span>
  </header>

  <div class="image-viewer">
    <div id="panzoom-container">
      <img id="newspaper-image" 
           alt="{{ page.newspaper }} - {{ page.dateDisplay }} - Page {{ page.pageNumber }}">
    </div>
    
    <div class="viewer-controls">
      <button id="zoom-in">Zoom In</button>
      <button id="zoom-out">Zoom Out</button>
      <button id="reset-zoom">Reset</button>
      <a href="{{ page.jpg }}" download class="download-btn">Download Image</a>
    </div>
  </div>

  <nav class="page-navigation">
    <div class="page-nav">
      {% if page.prevPage %}
      <a href="../{{ page.prevPage }}/" class="nav-btn">&larr; Previous Page</a>
      {% else %}
      <span class="nav-btn disabled">&larr; Previous Page</span>
      {% endif %}
      
      {% if page.nextPage %}
      <a href="../{{ page.nextPage }}/" class="nav-btn">Next Page &rarr;</a>
      {% else %}
      <span class="nav-btn disabled">Next Page &rarr;</span>
      {% endif %}
    </div>
    
    <div class="issue-nav">
      {% if page.prevIssue %}
      <a href="../{{ page.prevIssue }}-001/" class="nav-btn">&larr; Previous Issue</a>
      {% else %}
      <span class="nav-btn disabled">&larr; Previous Issue</span>
      {% endif %}
      
      {% if page.nextIssue %}
      <a href="../{{ page.nextIssue }}-001/" class="nav-btn">Next Issue &rarr;</a>
      {% else %}
      <span class="nav-btn disabled">Next Issue &rarr;</span>
      {% endif %}
    </div>
  </nav>
</article>

<script src="../../assets/js/viewer.js"></script>
```

---

### 5. About Page (`src/about.njk`)

**Layout:** Uses `base.njk`

**Content:**
- Project description
- Collection scope and statistics
- Technical details (optional)
- Credits/acknowledgments

**Template structure:**
```njk
---
layout: layouts/base.njk
title: "About"
---

<h1>About This Archive</h1>

<section>
  <h2>Collection Overview</h2>
  <p>This archive contains {{ metadata.totalPages }} digitized newspaper pages from {{ metadata.totalIssues }} historical newspaper issues.</p>
  
  <h2>Technical Details</h2>
  <ul>
    <li>Images scanned at 400 DPI</li>
    <li>OCR text extracted for search functionality</li>
    <li>Full-text search powered by FlexSearch</li>
  </ul>
</section>
```

---

## Component Specifications

### Base Layout (`_includes/layouts/base.njk`)

**Purpose:** HTML boilerplate template for all pages

**Structure:**
```njk
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if title %}{{ title }} - {% endif %}Newspaper Archive</title>
  
  <!-- Simple.css from CDN -->
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | url }}">
  
  <!-- FlexSearch -->
  <script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
  
  <!-- Panzoom -->
  <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
</head>
<body>
  {% include "components/header.njk" %}
  
  <main>
    {{ content | safe }}
  </main>
  
  {% include "components/footer.njk" %}
</body>
</html>
```

**Key Requirements:**
- All links must be relative (for file:// protocol support)
- Use `| url` filter for internal links
- Include CDN fallbacks or local copies of libraries

---

### Header Component (`_includes/components/header.njk`)

**Content:**
- Site title (links to home)
- Primary navigation: Home, Browse, Search, About

**Structure:**
```njk
<header>
  <nav>
    <a href="{{ '/' | url }}"><strong>Newspaper Archive</strong></a>
    <ul>
      <li><a href="{{ '/' | url }}">Home</a></li>
      <li><a href="{{ '/browse/' | url }}">Browse</a></li>
      <li><a href="{{ '/search/' | url }}">Search</a></li>
      <li><a href="{{ '/about/' | url }}">About</a></li>
    </ul>
  </nav>
</header>
```

---

### Footer Component (`_includes/components/footer.njk`)

**Content:**
- Simple copyright or project info
- Minimal styling

**Structure:**
```njk
<footer>
  <p>Historical Newspaper Archive &copy; 2026</p>
</footer>
```

---

### Search Form Component (`_includes/components/search-form.njk`)

**Content:**
- Search input field
- Search button
- Submits to `/search/` page with query parameter

**Structure:**
```njk
<form action="{{ '/search/' | url }}" method="get" class="search-form">
  <label for="search-query" class="visually-hidden">Search newspapers</label>
  <input 
    type="search" 
    id="search-query" 
    name="q" 
    placeholder="Search newspaper pages..." 
    value="{{ query }}"
    required>
  <button type="submit">Search</button>
</form>

<details class="search-help">
  <summary>Search tips</summary>
  <ul>
    <li>Use AND, OR, NOT for boolean search</li>
    <li>Example: "school AND teacher"</li>
    <li>Example: "farm NOT wheat"</li>
  </ul>
</details>
```

---

## JavaScript Specifications

### Search Implementation (`assets/js/search.js`)

**Purpose:** Handle search functionality on search results page

**Requirements:**
1. Read `?q=` parameter from URL
2. Load `search-index.json`
3. Initialize FlexSearch with appropriate options
4. Execute search query
5. Parse boolean operators (AND, OR, NOT)
6. Render results dynamically
7. Display result count
8. Handle no results case

**Key FlexSearch Configuration:**
```javascript
const index = new FlexSearch.Document({
  document: {
    id: "filename",
    index: ["content", "newspaper"],
    store: ["filename", "newspaper", "date", "dateDisplay", "pageNumber", "issueId"]
  },
  tokenize: "forward",
  context: true
});
```

**Search Result HTML Template:**
```javascript
function renderResult(result) {
  return `
    <article class="search-result">
      <a href="../pages/${result.filename}/">
        <img src="../${result.thumbnail}" alt="${result.newspaper} - ${result.dateDisplay}" loading="lazy">
      </a>
      <h3><a href="../pages/${result.filename}/">${result.newspaper}</a></h3>
      <time>${result.dateDisplay}</time>
      <p>Page ${result.pageNumber}</p>
    </article>
  `;
}
```

---

### Image Viewer (`assets/js/viewer.js`)

**Purpose:** Initialize Panzoom on detail pages

**Requirements:**
1. Initialize Panzoom on `#newspaper-image`
2. Wire up zoom in/out/reset buttons
3. Set appropriate zoom limits
4. Handle touch/mouse gestures

**Implementation:**
```javascript
document.addEventListener('DOMContentLoaded', function() {
  const elem = document.getElementById('newspaper-image');
  const panzoom = Panzoom(elem, {
    maxScale: 5,
    minScale: 0.5,
    step: 0.3
  });

  // Zoom controls
  document.getElementById('zoom-in').addEventListener('click', panzoom.zoomIn);
  document.getElementById('zoom-out').addEventListener('click', panzoom.zoomOut);
  document.getElementById('reset-zoom').addEventListener('click', panzoom.reset);

  // Mouse wheel zoom
  elem.parentElement.addEventListener('wheel', panzoom.zoomWithWheel);
});
```

---

## Custom CSS (`assets/css/custom.css`)

**Purpose:** Minimal style overrides for simple.css

**Key Styles:**
```css
/* Grid layouts for browse and search results */
.issues-grid,
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 2rem;
  margin: 2rem 0;
}

/* Card styling */
.issue-card,
.search-result {
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1rem;
  text-align: center;
}

.issue-card img,
.search-result img {
  width: 100%;
  height: auto;
  border-radius: 4px;
}

/* Search form */
.search-form {
  display: flex;
  gap: 0.5rem;
  max-width: 600px;
  margin: 2rem auto;
}

.search-form input {
  flex: 1;
}

/* Image viewer */
#panzoom-container {
  max-width: 100%;
  max-height: 70vh;
  overflow: hidden;
  border: 1px solid var(--border);
  cursor: grab;
}

#panzoom-container:active {
  cursor: grabbing;
}

#newspaper-image {
  max-width: 100%;
  height: auto;
  display: block;
}

.viewer-controls {
  display: flex;
  gap: 1rem;
  margin: 1rem 0;
  justify-content: center;
}

/* Navigation */
.page-navigation {
  margin: 2rem 0;
}

.page-nav,
.issue-nav {
  display: flex;
  justify-content: space-between;
  margin: 1rem 0;
}

.nav-btn {
  padding: 0.5rem 1rem;
  border: 1px solid var(--border);
  border-radius: 4px;
  text-decoration: none;
}

.nav-btn.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Stats section */
.stats {
  display: flex;
  justify-content: center;
  gap: 3rem;
  margin: 3rem 0;
  text-align: center;
}

.stats strong {
  display: block;
  font-size: 2rem;
}

/* Accessibility */
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
```

---

## File Protocol Compatibility

**Critical Requirements:**

1. **All paths must be relative:**
   - Use `../` for parent directories
   - Never use absolute paths like `/assets/`
   - Eleventy `| url` filter should produce relative paths

2. **Configure Eleventy for relative URLs:**
```javascript
// In .eleventy.js
eleventyConfig.addFilter("url", function(url) {
  // Ensure relative paths
  return url.replace(/^\//, './');
});
```

3. **Data file references:**
   - In `issues-metadata.json`, all image paths should be relative
   - Example: `"../data/THUMBs/issue/page.jpg"` NOT `"/data/THUMBs/issue/page.jpg"`

4. **CDN alternatives:**
   - Provide option to download libraries locally
   - Reference local files if CDN unavailable in offline mode

5. **Testing:**
   - Test by opening `_site/index.html` directly in browser via file://
   - All navigation, images, and search should work

---

## Development Workflow

### Initial Setup
```bash
npm init -y
npm install @11ty/eleventy --save-dev
```

### Development Commands
```bash
# Run dev server (with live reload)
npx @11ty/eleventy --serve

# Build for production
npx @11ty/eleventy

# Test file protocol (after build)
# Open _site/index.html in browser
```

### Build Process Order
1. Run build scripts to generate `search-index.json` and `issues-metadata.json`
2. Run Eleventy to generate site
3. Test in browser (both HTTP server and file:// protocol)

---

## Testing Checklist

- [ ] All pages render correctly
- [ ] Navigation works (home, browse, search, about)
- [ ] Search form submits to search page
- [ ] Search results display correctly
- [ ] Boolean search operators work (AND, OR, NOT)
- [ ] Browse page groups by year correctly
- [ ] Issue cards display thumbnails and metadata
- [ ] Detail pages load with correct image
- [ ] Panzoom works (zoom in/out/reset, wheel zoom)
- [ ] Download button links to correct JPG
- [ ] Page navigation (prev/next) works
- [ ] Issue navigation (prev/next) works
- [ ] Site works from file:// protocol
- [ ] All images load with relative paths
- [ ] No console errors
- [ ] Responsive on mobile devices

---

## Future Enhancements (Out of Scope)

- Advanced search filters (date range, newspaper name)
- Thumbnail grid view on detail pages
- Keyboard shortcuts for navigation
- Print-friendly CSS
- Dark mode toggle
- Export search results

---

**Document Version:** 1.0  
**Created:** 2026-01-31  
**For:** Claude Code Implementation


